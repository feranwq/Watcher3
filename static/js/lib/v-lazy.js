!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):n.install=e()}(this,function(){"use strict";var n=function(n){return"[object String]"===Object.prototype.toString.call(n)},e=function(n,e,t){return n.addEventListener(e,t,!1)},t=function(n,e,t){return n.removeEventListener(e,t,!1)},i=function(n,e){if(n.length){var t=n.indexOf(e);return t>-1?n.splice(t,1):void 0}},r=function(r){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a="2"===r.version.split(".")[0],d="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",u=o.listenEvents||["scroll","wheel","mousewheel","resize","animationend","transitionend"],s={listeners:{loading:[],loaded:[],error:[]},$on:function(n,e){this.listeners[n].push(e)},$once:function(n,e){function t(){i.$off(n,t),e.apply(i,arguments)}var i=this;this.$on(n,t)},$off:function(n,e){return e?void i(this.listeners[n],e):this.listeners[n]=[]},$emit:function(n,e){this.listeners[n].forEach(function(n){return n(e)})}},l={preLoad:o.preLoad||1.3,error:o.error||d,loading:o.loading||d,attempt:o.attempt||3,hasbind:!1},c=[],f=[],p=function(n,e){var t=null,i=0;return function(){var r=this,o=arguments;if(!t){var a=function(){i=Date.now(),t=!1,n.apply(r,o)};Date.now()-i>=e?a():t=setTimeout(a,e)}}},h=p(function(){c.forEach(function(n){return v(n)})},300),g=function(n,i){i||(l.hasbind=!1),u.forEach(function(r){return(i?e:t)(n,r,h)})},v=function(n){if(-1!==f.indexOf(n.src))return m(n.el,n.bindType,n.src,"loaded");var e=n.el.getBoundingClientRect(),t=l.preLoad;e.top<window.innerHeight*t&&e.bottom>0&&e.left<window.innerWidth*t&&e.right>0&&b(n)},A=function(n,e,t){n.setAttribute("lazy",e),t&&s.$emit(e,t)},m=function(n,t,i,r,o){return t?(n.style[t]="url("+i+")",A(n,r,o)):(n.setAttribute("src",i),void e(n,"load",function(){A(n,r,o)}))},b=function(n){return n.attempt>=l.attempt?!1:(n.attempt++,-1!==f.indexOf(n.src)?m(n.el,n.bindType,n.src,"loaded"):(f.push(n.src),void y(n,function(){m(n.el,n.bindType,n.src,"loaded",n),i(c,n)},function(){i(f,n.src),m(n.el,n.bindType,n.error,"error",n)})))},y=function(n,t,i){var r=new Image;e(r,"load",function(){t({naturalHeight:r.naturalHeight,naturalWidth:r.naturalWidth,src:n.src})}),e(r,"error",i),r.src=n.src},w=function(n){if(n){for(var e=0,t=c.length;t>e;e++)c[e]&&c[e].el===n&&c.splice(e,1);l.hasbind&&!c.length&&g(window,!1)}},E=function(n){return c.some(function(e){return e.el===n})?r.nextTick(h):void 0},$=function(e,t,i){var o=t.arg,a=t.value,d=t.modifiers,u=i.context.$refs;if("loaded"!==e.getAttribute("lazy")&&!E(e)){var s=void 0,p=a,v=l.loading,A=l.error,b=void 0;return a&&!n(a)&&(p=a.src,v=a.loading||l.loading,A=a.error||l.error,b=a.containerRef),f.indexOf(p)>-1?m(e,o,p,"loaded"):void r.nextTick(function(){var n=void 0;s=b&&(n=u[b])?n.$el||n:window.document.getElementById(Object.keys(d)[0]);var t={bindType:o,attempt:0,parentEl:s,el:e,error:A,src:p};c.push(t),m(e,o,v,"loading",t),h(),c.length>0&&!l.hasbind&&(l.hasbind=!0,g(window,!0),s&&g(s,!0))})}};Object.assign(r.prototype,"$lazy",{value:s,readable:!0,writable:!1}),r.directive("lazy",a?{bind:$,update:$,inserted:$,componentUpdated:h,unbind:w}:{bind:h,update:function(n,e){$(this.el,{modifiers:this.modifiers,arg:this.arg,value:n,oldValue:e})},unbind:function(){w(this.el)}})};return r});